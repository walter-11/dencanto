<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Intranet - Registrar Ventas</title>
  <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css" />
  <link rel="stylesheet" href="/css/intranet-common.css" />
  <link rel="stylesheet" href="/css/ventas.css" />
</head>

<body>
  <div class="wrapper">
    
        <aside id="sidebar" class="">
            <div class="d-flex justify-content-between p-4">
                <div class="sidebar-logo">
                    <a href="#">Colchones D'<br />Encanto</a>
                </div>
                <button class="toggle-btn border-0" type="button">
                    <i id="icon" class="bx bxs-chevrons-right"></i>
                </button>
            </div>
            <ul class="sidebar-nav">
                
                <li class="sidebar-item">
                    <a href="/intranet/dashboard" class="sidebar-link">
                        <i class="bx bx-history"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                
                <li th:if="${rol} == 'ADMIN'" class="sidebar-item">
                    <a href="/intranet/reportes" class="sidebar-link">
                        <i class="bx bxs-report"></i>
                        <span>Generar Reportes</span>
                    </a>
                </li>
                <li th:if="${rol} == 'ADMIN'" class="sidebar-item">
                    <a href="/intranet/productos" class="sidebar-link">
                        <i class="bx bxs-box"></i>
                        <span>Gestión de Productos</span>
                    </a>
                </li>
                <li th:if="${rol} == 'ADMIN'" class="sidebar-item">
                    <a href="/intranet/usuarios" class="sidebar-link">
                        <i class="bx bxs-user-account"></i>
                        <span>Gestión de Usuarios</span>
                    </a>
                </li>
                <li th:if="${rol} == 'ADMIN'" class="sidebar-item">
                    <a href="/intranet/cotizaciones" class="sidebar-link">
                        <i class="bx bxs-food-menu"></i>
                        <span>Visualizar Cotizaciones</span>
                    </a>
                </li>
                
                <li th:if="${rol} == 'VENDEDOR'" class="sidebar-item">
                    <a href="/intranet/revisarCotizaciones" class="sidebar-link">
                        <i class="bx bxs-file"></i>
                        <span>Revisar Cotizaciones</span>
                    </a>
                </li>
                <li th:if="${rol} == 'VENDEDOR'" class="sidebar-item">
                    <a href="/intranet/ventas" class="sidebar-link">
                        <i class="bx bxs-cart"></i>
                        <span>Registrar Ventas</span>
                    </a>
                </li>
                <li th:if="${rol} == 'VENDEDOR'" class="sidebar-item">
                    <a href="/intranet/historialVentas" class="sidebar-link">
                        <i class="bx bx-search-alt-2"></i>
                        <span>Historial de Ventas</span>
                    </a>
                </li>
            </ul>
            <div class="sidebar-footer">
                <a href="/intranet/login" class="sidebar-link" onclick="confirmLogout()">
                    <i class="bx bx-log-out"></i>
                    <span>Cerrar Sesión</span>
                </a>
            </div>
        </aside>

    
    <div class="main">
      
      <nav class="navbar navbar-expand px-4 py-3">
        <div class="navbar-collapse collapse">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <span class="nav-link">
                <b></b>
                <span id="rolDisplay">VENDEDOR</span>
              </span>
            </li>
            <li class="nav-item-dropdown">
              <a href="#" data-bs-toggle="dropdown" class="nav-icon pe-md-0">
                <img src="/img/account.png" class="avatar img-fluid" alt="" />
              </a>
            </li>
          </ul>
        </div>
      </nav>

      
      <main class="content">
        <div class="container-fluid">
          
          <div class="steps-container">
            <div class="steps-indicator">
              <div class="step-item active" id="step1">
                <div class="step-circle">1</div>
                <div class="step-label">Productos</div>
              </div>
              <div class="step-item" id="step2">
                <div class="step-circle">2</div>
                <div class="step-label">Cliente</div>
              </div>
              <div class="step-item" id="step3">
                <div class="step-circle">3</div>
                <div class="step-label">Pago</div>
              </div>
            </div>
          </div>

          
          <div id="alertContainer"></div>

          
          <form id="ventaForm">
            
            <div class="form-section active" id="step1-content">
              <div class="card">
                <div class="card-body">
                  <div class="form-title">
                    <i class="bx bxs-box"></i>
                    Seleccionar Productos
                  </div>

                  
                  <div class="product-search">
                    <i class="bx bx-search-alt" style="position: absolute; left: 15px; top: 12px; color: #6c757d;"></i>
                    <input type="text" id="productSearch" placeholder="Buscar por nombre o categoría...">
                  </div>

                  
                  <div class="products-grid" id="products-list">
                    
                  </div>

                  
                  <div class="cart-summary" id="selected-products">
                    <h5><i class="bx bx-cart"></i> Carrito de Compra</h5>
                    <p style="color: #6c757d; margin: 0;">No hay productos seleccionados</p>
                  </div>

                  
                  <div class="buttons-container">
                    <button type="button" class="btn-nav btn-prev" id="btnPrev" onclick="previousStep(currentStep)"
                      style="display: none;">
                      <i class="bx bx-arrow-back"></i> Anterior
                    </button>
                    <button type="button" class="btn-nav btn-next" id="btnNext" onclick="nextStep(currentStep)">
                      Siguiente <i class="bx bx-arrow-forward"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>

            
            <div class="form-section" id="step2-content">
              <div class="card">
                <div class="card-body">
                  <div class="form-title">
                    <i class="bx bxs-user"></i>
                    Información del Cliente
                  </div>

                  
                  <div id="newClientFields">
                    <div class="form-group">
                      <label for="clienteName">Nombre Completo *</label>
                      <input type="text" id="clienteName" placeholder="Nombre del cliente" minlength="3"
                        maxlength="100" required>
                      <span class="validation-error" id="errorClienteName"></span>
                      <small class="input-hint">3-100 caracteres</small>
                    </div>

                    <div class="form-group">
                      <label for="clientePhone">Teléfono *</label>
                      <input type="tel" id="clientePhone" placeholder="987654321" pattern="\d{9}" maxlength="9" required>
                      <span class="validation-error" id="errorClientePhone"></span>
                      <small class="input-hint">9 dígitos numéricos</small>
                    </div>

                    <div class="form-group">
                      <label for="clienteEmail">Correo Electrónico *</label>
                      <input type="email" id="clienteEmail" placeholder="cliente@email.com" required>
                      <span class="validation-error" id="errorClienteEmail"></span>
                      <small class="input-hint">Formato: ejemplo@correo.com</small>
                    </div>
                  </div>

                  
                  <div class="form-group">
                    <label>Tipo de Entrega *</label>
                    <div class="delivery-type">
                      <div class="radio-option">
                        <input type="radio" id="recojoOption" name="tipoEntrega" value="RECOJO" checked>
                        <label for="recojoOption">Recojo en Tienda</label>
                      </div>
                      <div class="radio-option">
                        <input type="radio" id="domicilioOption" name="tipoEntrega" value="DOMICILIO">
                        <label for="domicilioOption">Entrega a Domicilio</label>
                      </div>
                    </div>
                  </div>

                  
                  <div class="form-group" id="direccionGroup" style="display: none;">
                    <label for="direccion">Dirección de Entrega *</label>
                    <textarea id="direccion" placeholder="Ej: Av. Principal 123, Apto 4B, Lima" rows="3" minlength="10"
                      maxlength="255"></textarea>
                  </div>

                  
                  <div class="form-group">
                    <label for="costoDelivery">Costo de Delivery (S/)</label>
                    <input type="number" id="costoDelivery" value="0" min="0" step="0.01">
                  </div>

                  
                  <div class="buttons-container">
                    <button type="button" class="btn-nav btn-prev" onclick="previousStep(currentStep)">
                      <i class="bx bx-arrow-back"></i> Anterior
                    </button>
                    <button type="button" class="btn-nav btn-next" onclick="nextStep(currentStep)">
                      Siguiente <i class="bx bx-arrow-forward"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>

            
            <div class="form-section" id="step3-content">
              <div class="card">
                <div class="card-body">
                  <div class="form-title">
                    <i class="bx bxs-credit-card"></i>
                    Información de Pago
                  </div>

                  
                  <div class="form-group">
                    <label for="paymentMethod">Método de Pago *</label>
                    <div class="payment-method-box">
                      <select id="paymentMethod" required>
                        <option value="">-- Seleccionar método --</option>
                        <option value="EFECTIVO">Efectivo</option>
                        <option value="YAPE">Yape</option>
                        <option value="PLIN">Plin</option>
                        <option value="TRANSFERENCIA">Transferencia Bancaria</option>
                      </select>
                    </div>
                  </div>

                  
                  
                  <div id="cash-payment" class="payment-fields hidden">
                    <h6>Pago en Efectivo</h6>
                    <div class="form-group">
                      <label for="amountReceived">Monto Recibido (S/) *</label>
                      <input type="number" id="amountReceived" placeholder="0.00" min="0" step="0.01">
                    </div>
                    <div class="form-group">
                      <label for="changeAmount">Vuelto (S/)</label>
                      <input type="number" id="changeAmount" readonly value="0.00">
                    </div>
                  </div>
                  
                  <div id="yapeplin-payment" class="payment-fields hidden">
                    <h6>Yape/Plin</h6>
                    <p style="color: #6c757d; font-size: 0.9rem;">
                      <strong>Yape:</strong> 934078986<br>
                      <strong>Plin:</strong> 98765432101<br>
                      Favor de confirmar depósito por WhatsApp
                    </p>
                  </div>

                  
                  <div id="bank-transfer-payment" class="payment-fields hidden">
                    <h6>Transferencia Bancaria</h6>
                    <p style="color: #6c757d; font-size: 0.9rem;">
                      <strong>N° Cuenta BCP:</strong> 12345678901<br>
                      <strong>N° Cuenta Interbank:</strong> 98765432101<br>
                      Favor de confirmar depósito por WhatsApp
                    </p>
                  </div>

                  
                  <div class="form-group">
                    <label for="deliveryDate">Fecha de Entrega *</label>
                    <input type="date" id="deliveryDate" required>
                  </div>

                  
                  <div class="cart-summary" style="margin-top: 2rem;">
                    <h5>Resumen de Compra</h5>
                    <div class="total-row">
                      <span>Subtotal:</span>
                      <span>S/ <span id="resumen-subtotal">0.00</span></span>
                    </div>
                    <div class="total-row">
                      <span>IGV (18%):</span>
                      <span>S/ <span id="resumen-igv">0.00</span></span>
                    </div>
                    <div class="total-row">
                      <span>Delivery:</span>
                      <span>S/ <span id="resumen-delivery">0.00</span></span>
                    </div>
                    <div class="total-row final">
                      <span>Total:</span>
                      <span>S/ <span id="resumen-total">0.00</span></span>
                    </div>
                  </div>

                  
                  <div class="buttons-container">
                    <button type="button" class="btn-nav btn-prev" onclick="previousStep(currentStep)">
                      <i class="bx bx-arrow-back"></i> Anterior
                    </button>
                    <button type="button" class="btn-nav btn-submit" id="btnSubmit" onclick="processSale()">
                      <i class="bx bxs-check-circle"></i> Registrar Venta
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </form>
        </div>
      </main>
    </div>
  </div>

  
  <div class="modal fade" id="successModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">¡Venta Registrada Exitosamente!</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body text-center">
          <div class="success-icon">
            <i class="bx bxs-check-circle"></i>
          </div>
          <h6 style="color: var(--primary);">Referencia de Venta</h6>
          <p style="font-size: 1.3rem; font-weight: 700; color: var(--secondary); margin-bottom: 1rem;"
            id="modalVentaId">V-2024-0001</p>
          <p style="color: #6c757d; margin-bottom: 0.5rem;">Total: <strong id="modalTotal"
              style="color: var(--secondary); font-size: 1.1rem;">S/ 0.00</strong></p>
          <p style="color: #6c757d;">La venta ha sido registrada correctamente en el sistema.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-success" data-bs-dismiss="modal" onclick="recargarPagina()">
            <i class="bx bx-plus"></i> Nueva Venta
          </button>
        </div>
      </div>
    </div>
  </div>

  
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/js/authUtils.js"></script>
  <script src="/js/scriptIntranetCommon.js"></script>
  <script src="/js/scriptVentas.js"></script>
</body>

</html>